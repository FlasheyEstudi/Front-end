<div class="container">
  <h2>Gesti√≥n de Detalles de Pago</h2>

  <div class="messages">
    <div *ngIf="errorMsg" class="error">{{ errorMsg }}</div>
    <div *ngIf="successMsg" class="success">{{ successMsg }}</div>
  </div>

  <div class="search-box">
    <input type="text" placeholder="Buscar..." [(ngModel)]="searchTerm" (input)="onSearch()"/>
  </div>

  <div *ngIf="loading" class="loading">Cargando...</div>

  <table *ngIf="!loading" class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Solicitud Beca</th>
        <th>Tipo Pago</th>
        <th>Monto</th>
        <th>Fecha Pago</th>
        <th>Referencia</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let detalle of filteredDetallesDePago">
        <td>{{detalle.Id}}</td>
        <td>{{getSolicitudBecaReferencia(detalle.SolicitudBecaId)}}</td>
        <td>{{getTipoPagoNombre(detalle.TipoPagoId)}}</td>
        <td>{{detalle.Monto | number:'1.2-2'}}</td>
        <td>{{detalle.FechaPago | date:'yyyy-MM-dd'}}</td>
        <td>{{detalle.Referencia}}</td>
        <td>{{getEstadoNombre(detalle.EstadoId)}}</td>
        <td>
          <button (click)="editDetallePago(detalle)">Editar</button>
          <button (click)="deleteDetallePago(detalle.Id)">Eliminar</button>
        </td>
      </tr>
    </tbody>
  </table>

  <hr/>

  <div class="form-container">
    <h3>{{editMode ? 'Editar Detalle' : 'Nuevo Detalle'}}</h3>
    <form (ngSubmit)="guardarDetallePago()">
      <label>Solicitud Beca:</label>
      <select [(ngModel)]="nuevoDetallePago.SolicitudBecaId" name="solicitud">
        <option *ngFor="let s of solicitudesBecaLookup" [value]="s.Id">{{s.Referencia}}</option>
      </select>

      <label>Tipo Pago:</label>
      <select [(ngModel)]="nuevoDetallePago.TipoPagoId" name="tipoPago">
        <option *ngFor="let t of tiposPagoLookup" [value]="t.Id">{{t.Nombre}}</option>
      </select>

      <label>Monto:</label>
      <input type="number" [(ngModel)]="nuevoDetallePago.Monto" name="monto"/>

      <label>Fecha Pago:</label>
      <input type="date" [(ngModel)]="nuevoDetallePago.FechaPago" name="fechaPago"/>

      <label>Referencia:</label>
      <input type="text" [(ngModel)]="nuevoDetallePago.Referencia" name="referencia"/>

      <label>Estado:</label>
      <select [(ngModel)]="nuevoDetallePago.EstadoId" name="estado">
        <option *ngFor="let e of estadosLookup" [value]="e.Id">{{e.Nombre}}</option>
      </select>

      <div class="form-buttons">
        <button type="submit">{{editMode ? 'Actualizar' : 'Agregar'}}</button>
        <button type="button" (click)="cancelEdit()">Cancelar</button>
      </div>
    </form>
  </div>
</div>
