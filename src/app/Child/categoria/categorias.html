<div class="categorias-container">
  <!-- Header -->
  <div class="page-header">
    <h1>Categor√≠as de Becas</h1>
    <p>Gestiona las categor√≠as y niveles de becas con precios configurables</p>
  </div>

  <!-- Bot√≥n Nueva Categor√≠a -->
  <button class="btn-nuevo" (click)="abrirModalCrear()">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
      <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    Nueva Categor√≠a
  </button>

  <!-- KPIs -->
  <!-- Aseg√∫rate de que los valores se actualicen desde this.resumen -->
  <div class="kpi-grid">
    <div class="kpi-card blue">
      <div class="kpi-icon">üè∑Ô∏è</div>
      <div class="kpi-content">
        <h2>{{ resumen.CategoriasConfiguradas }}</h2>
        <p>Categor√≠as Configuradas</p>
        <small>Total</small>
      </div>
    </div>
    <div class="kpi-card green">
      <div class="kpi-icon">üë•</div>
      <div class="kpi-content">
        <h2>{{ resumen.BeneficiariosTotales }}</h2>
        <p>Beneficiarios Totales</p>
        <small>Activos</small>
      </div>
    </div>
    <div class="kpi-card red">
      <div class="kpi-icon">üí∞</div>
      <div class="kpi-content">
        <h2>{{ resumen.PresupuestoTotal | currency:'NIO' }}</h2>
        <p>Presupuesto Total</p>
        <small>Asignado</small>
      </div>
    </div>
    <div class="kpi-card purple">
      <div class="kpi-icon">üìà</div>
      <div class="kpi-content">
        <h2>{{ resumen.CategoriasActivas }}</h2>
        <p>Categor√≠as Activas</p>
        <small>de {{ resumen.CategoriasConfiguradas }}</small>
      </div>
    </div>
  </div>

  <!-- Indicador de carga -->
  <div *ngIf="loading" class="loading-indicator">
    Cargando...
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <!-- Tabla de categor√≠as -->
  <div class="table-container">
    <div class="table-responsive">
      <table class="data-table">
        <thead>
          <tr>
            <th>Categor√≠a</th>
            <th>Nombre</th>
            <th>Cobertura</th>
            <th>Monto</th>
            <th>Prioridad</th>
            <th>Beneficiarios</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let categoria of categorias">
            <!-- Usar categoria.Categoria y categoria.ColorHex -->
            <td>
              <div class="categoria-badge" [style.background-color]="categoria.ColorHex || '#ccc'">
                <span class="badge-letter">{{ categoria.Categoria }}</span>
              </div>
            </td>
            <td>
              <div class="categoria-name">{{ categoria.Nombre }}</div>
              <div class="categoria-description">{{ categoria.Descripcion }}</div>
            </td>
            <!-- Usar categoria.PorcentajeCobertura -->
            <td>
              <div class="cobertura-badge">
                {{ categoria.PorcentajeCobertura }}%
              </div>
            </td>
            <td>{{ categoria.Monto | currency:'NIO' }}</td>
            <td>
              <div class="prioridad-badge">
                Prioridad {{ categoria.Prioridad }}
              </div>
            </td>
            <td>
              <div class="beneficiarios-count">{{ categoria.Beneficiarios }}</div>
            </td>
            <td>
              <span class="status-badge" [class.active]="categoria.EstadoId === 1">
                {{ getEstadoNombre(categoria.EstadoId) }}
              </span>
            </td>
            <td>
              <!-- Corregido: Usar abrirModalEditar -->
              <button class="btn-action edit" (click)="abrirModalEditar(categoria)" [disabled]="loading">‚úèÔ∏è</button>
              <button class="btn-action delete" (click)="eliminarCategoria(categoria.Id!)" [disabled]="loading">üóëÔ∏è</button>
            </td>
          </tr>
          <!-- Mostrar mensaje si no hay datos y no est√° cargando -->
          <tr *ngIf="categorias.length === 0 && !loading">
            <td colspan="8" class="no-results">
              No hay categor√≠as registradas
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal de Creaci√≥n -->
  <div *ngIf="showCreateModal" class="modal-overlay" (click)="cerrarModalCrear()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Nueva Categor√≠a de Beca</h3>
        <button class="close-button" (click)="cerrarModalCrear()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <!-- Mostrar error espec√≠fico del formulario si existe -->
        <div *ngIf="error && !showEditModal" class="error-message">{{ error }}</div>
        <form (ngSubmit)="crearCategoria()" #createForm="ngForm">
          <div class="form-row">
            <div class="form-group">
              <label for="categoria">Categor√≠a *</label>
              <select id="categoria" [(ngModel)]="nuevaCategoria.Categoria" name="Categoria" required>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
              </select>
            </div>
            <div class="form-group">
              <label for="nombre">Nombre de la Categor√≠a *</label>
              <input type="text" id="nombre" [(ngModel)]="nuevaCategoria.Nombre" name="Nombre" required>
            </div>
          </div>
          <div class="form-group">
            <label for="descripcion">Descripci√≥n</label>
            <textarea id="descripcion" [(ngModel)]="nuevaCategoria.Descripcion" name="Descripcion" rows="3"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="cobertura">% de Cobertura *</label>
              <!-- Usar nuevaCategoria.PorcentajeCobertura -->
              <input type="number" id="cobertura" [(ngModel)]="nuevaCategoria.PorcentajeCobertura" name="PorcentajeCobertura" required min="1" max="100">
            </div>
            <div class="form-group">
              <label for="monto">Monto (NIO) *</label>
              <input type="number" id="monto" [(ngModel)]="nuevaCategoria.Monto" name="Monto" required min="0" step="0.01"> <!-- step para decimales -->
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="prioridad">Prioridad *</label>
              <select id="prioridad" [(ngModel)]="nuevaCategoria.Prioridad" name="Prioridad" required>
                <option [ngValue]="1">Prioridad 1</option>
                <option [ngValue]="2">Prioridad 2</option>
                <option [ngValue]="3">Prioridad 3</option>
                <option [ngValue]="4">Prioridad 4</option>
              </select>
            </div>
            <div class="form-group">
              <label for="colorIdentificativo">Color Identificativo</label>
              <!-- Usar nuevaCategoria.ColorHex -->
              <input type="color" id="colorIdentificativo" [(ngModel)]="nuevaCategoria.ColorHex" name="ColorHex">
            </div>
          </div>
          <div class="form-group">
            <label for="estado">Estado</label>
            <select id="estado" [(ngModel)]="nuevaCategoria.EstadoId" name="EstadoId" required>
              <option [ngValue]="1">Activa</option>
              <option [ngValue]="2">Inactiva</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-secundario" (click)="cerrarModalCrear()" [disabled]="loading">Cancelar</button>
            <button type="submit" class="btn-primario" [disabled]="createForm.invalid || loading">
              <span *ngIf="!loading">Crear Categor√≠a</span>
              <span *ngIf="loading" class="loading-spinner"></span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal de Edici√≥n -->
  <!-- Corregido: Solo mostrar si categoriaEdit no es null -->
  <div *ngIf="showEditModal && categoriaEdit" class="modal-overlay" (click)="cerrarModalEditar()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Editar Categor√≠a de Beca</h3>
        <button class="close-button" (click)="cerrarModalEditar()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
         <!-- Mostrar error espec√≠fico del formulario si existe -->
         <!-- Condici√≥n para evitar mostrar error de creaci√≥n aqu√≠ -->
         <div *ngIf="error && showEditModal" class="error-message">{{ error }}</div>
        <form (ngSubmit)="actualizarCategoria()" #editForm="ngForm">
          <div class="form-row">
            <div class="form-group">
              <label for="editCategoria">Categor√≠a *</label>
              <!-- Corregido: Usar navegaci√≥n segura (?) -->
              <select id="editCategoria" [(ngModel)]="categoriaEdit.Categoria" name="Categoria" required>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
              </select>
            </div>
            <div class="form-group">
              <label for="editNombre">Nombre de la Categor√≠a *</label>
              <!-- Corregido: Usar navegaci√≥n segura (?) -->
              <input type="text" id="editNombre" [(ngModel)]="categoriaEdit.Nombre" name="Nombre" required>
            </div>
          </div>
          <div class="form-group">
            <label for="editDescripcion">Descripci√≥n</label>
            <!-- Corregido: Usar navegaci√≥n segura (?) -->
            <textarea id="editDescripcion" [(ngModel)]="categoriaEdit.Descripcion" name="Descripcion" rows="3"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="editCobertura">% de Cobertura *</label>
              <!-- Corregido: Usar navegaci√≥n segura (?) -->
              <input type="number" id="editCobertura" [(ngModel)]="categoriaEdit.PorcentajeCobertura" name="PorcentajeCobertura" required min="1" max="100">
            </div>
            <div class="form-group">
              <label for="editMonto">Monto (NIO) *</label>
              <!-- Corregido: Usar navegaci√≥n segura (?) -->
              <input type="number" id="editMonto" [(ngModel)]="categoriaEdit.Monto" name="Monto" required min="0" step="0.01"> <!-- step para decimales -->
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="editPrioridad">Prioridad *</label>
              <!-- Corregido: Usar navegaci√≥n segura (?) -->
              <select id="editPrioridad" [(ngModel)]="categoriaEdit.Prioridad" name="Prioridad" required>
                <option [ngValue]="1">Prioridad 1</option>
                <option [ngValue]="2">Prioridad 2</option>
                <option [ngValue]="3">Prioridad 3</option>
                <option [ngValue]="4">Prioridad 4</option>
              </select>
            </div>
            <div class="form-group">
              <label for="editColorIdentificativo">Color Identificativo</label>
              <!-- Corregido: Usar navegaci√≥n segura (?) -->
              <input type="color" id="editColorIdentificativo" [(ngModel)]="categoriaEdit.ColorHex" name="ColorHex">
            </div>
          </div>
          <div class="form-group">
            <label for="editEstado">Estado</label>
             <!-- Corregido: Usar navegaci√≥n segura (?) -->
            <select id="editEstado" [(ngModel)]="categoriaEdit.EstadoId" name="EstadoId" required>
              <option [ngValue]="1">Activa</option>
              <option [ngValue]="2">Inactiva</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-secundario" (click)="cerrarModalEditar()" [disabled]="loading">Cancelar</button>
            <button type="submit" class="btn-primario" [disabled]="editForm.invalid || loading">
              <span *ngIf="!loading">Actualizar Categor√≠a</span>
              <span *ngIf="loading" class="loading-spinner"></span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>